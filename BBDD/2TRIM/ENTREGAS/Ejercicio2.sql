DROP TABLE SOCIOS CASCADE CONSTRAINTS;
CREATE TABLE SOCIOS(
    CODIGO_SOCIO CHAR(8) PRIMARY KEY,
    DNI CHAR(9),
    NOMBRE VARCHAR(100),
    APELLIDOS VARCHAR(200),
    DIRECCION VARCHAR(300),
    TELEFONO NUMBER(9)
);
DROP TABLE LIBROS CASCADE CONSTRAINTS;
CREATE TABLE LIBROS(
    ISBN CHAR(17) PRIMARY KEY ,
    TITULO VARCHAR(200),
    EDITORIAL VARCHAR(50),
    ANO_PUBLICACION INT,
    AUTORES VARCHAR(300),
    ANO_EDICION INT,
    DETERIORADO CHAR(2)
);
DROP TABLE PRESTAMOS CASCADE CONSTRAINTS;
CREATE TABLE PRESTAMOS(
    CODIGO_SOCIO CHAR(8) ,
    ISBN CHAR(17),
    FECHA_PRESTAMO DATE,
    FECHA_DEVOLUCION DATE,
    FECHA_REAL_DEVOLUCION DATE,
    PRIMARY KEY(CODIGO_SOCIO,ISBN)
);
ALTER TABLE SOCIOS ADD CHECK (REGEXP_LIKE(CODIGO_SOCIO,'S[0-9][0-9][0-9][0-9][0-9]23'));
ALTER TABLE SOCIOS ADD CHECK (REGEXP_LIKE(DNI,'[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][A-Z]'));
ALTER TABLE LIBROS ADD CHECK(REGEXP_LIKE(ISBN,'[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]ISBN'));
ALTER TABLE LIBROS ADD CHECK(DETERIORADO LIKE 'SI' OR DETERIORADO LIKE 'NO');

ALTER TABLE PRESTAMOS ADD CHECK(REGEXP_LIKE(CODIGO_SOCIO,'S[0-9][0-9][0-9][0-9][0-9]23'));
ALTER TABLE PRESTAMOS ADD CHECK(REGEXP_LIKE(ISBN,'[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]ISBN'));
ALTER TABLE PRESTAMOS ADD FOREIGN KEY(CODIGO_SOCIO) REFERENCES SOCIOS(CODIGO_SOCIO) ON DELETE SET NULL;
ALTER TABLE PRESTAMOS ADD FOREIGN KEY(ISBN) REFERENCES LIBROS(ISBN) ON DELETE SET NULL;
ALTER TABLE PRESTAMOS ADD CHECK (FECHA_DEVOLUCION = FECHA_PRESTAMO + 15);
ALTER TABLE PRESTAMOS ADD CHECK (FECHA_REAL_DEVOLUCION >= FECHA_PRESTAMO);

DELETE FROM SOCIOS;
INSERT INTO SOCIOS VALUES ('S0000123','12345678A','JHONATAN','GUZMAN PANOZO','CALLE LARGA 20',695887170);
INSERT INTO SOCIOS VALUES ('S0000223','11345678B','MARTA','NUÑEZ GARCIA','CALLE CORTA 14',695461895);

DELETE FROM LIBROS;
INSERT INTO LIBROS VALUES ('0123456789012ISBN','POR MEDIA VIENA','AGOSTINI',1984,'BENITO PEREZ PEREZ',1990,'NO');
INSERT INTO LIBROS VALUES ('0023456789012ISBN','POR MIS PISTOLAS','CCC',1994,'LUIS PEREZ GOMEZ',1995,'NO');
INSERT INTO LIBROS VALUES ('0123456789022ISBN','AHORA CAIGO','EDELVIVES',2015,'JUAN ANTONIO GARCIA PEREZ',2019,'NO');

DELETE FROM PRESTAMOS;
INSERT INTO PRESTAMOS VALUES ('S0000123','0123456789012ISBN','01-01-2023','16-01-2023','17-01-2023');
INSERT INTO PRESTAMOS VALUES ('S0000123','0023456789012ISBN','01-02-2023','16-02-2023','15-02-2023');
INSERT INTO PRESTAMOS VALUES ('S0000223','0123456789022ISBN','01-03-2023','16-03-2023','16-03-2023');

UPDATE SOCIOS SET NOMBRE = 'LUIS', APELLIDOS = 'PEREZ LOPEZ' WHERE CODIGO_SOCIO LIKE 'S0000123';
UPDATE SOCIOS SET NOMBRE = 'ANGELA', APELLIDOS = 'LOPEZ GOMEZ' WHERE CODIGO_SOCIO LIKE 'S0000223';
UPDATE LIBROS SET ANO_EDICION = 2018;
UPDATE LIBROS SET DETERIORADO = 'SI' WHERE ISBN LIKE '0123456789022ISBN';




